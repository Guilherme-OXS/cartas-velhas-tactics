<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="description" content="Cartas Velhas: Cyberpunk Tactics v2.1. Edi√ß√£o de Natal Extravagante.">
    <meta name="author" content="Guilherme Ot√°vio Xavier de Souza">
    
    <meta property="og:title" content="Cartas Velhas: Natal v2.1">
    <meta property="og:description" content="Vers√£o de Natal! Estrat√©gia, Luzes e Caos.">
    <meta property="og:type" content="website">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÖ</text></svg>">

    <title>Cartas Velhas: Natal v2.1</title>
    
    <link rel="stylesheet" href="style.css?v=2.1">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="snow-overlay" class="hidden"></div>
    <div id="christmas-lights-border" class="hidden"></div> <div id="loading-screen">
        <div class="loader-content">
            <div class="glitch-text" id="boot-title" style="font-size: 2rem; font-weight: bold; margin-bottom: 20px;">SYSTEM BOOT v2.1</div>
            <div class="loading-bar-frame">
                <div id="loading-fill" class="loading-bar-fill"></div>
            </div>
            <div id="loading-text" style="font-family: monospace; color: #ff0033; font-size: 0.8rem; margin-top: 10px;">> WRAPPING PRESENTS...</div>
        </div>
    </div>

    <div id="invite-modal" class="hidden">
        <div style="color:#ffd700; font-weight:bold; margin-bottom:10px;">üéÅ CONVITE DE NATAL</div>
        <div id="invite-text" style="color:#fff; font-size:0.9rem; margin-bottom:15px;">...</div>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button class="cyber-btn" onclick="acceptInvite()">ACEITAR</button>
            <button class="cyber-btn secondary" onclick="closeInvite()">IGNORAR</button>
        </div>
    </div>

    <div id="canvas-container" style="position: absolute; top:0; left:0; width:100%; height:100%;"></div>

    <div id="modal-nickname" class="hidden">
        <div class="cyber-panel" style="text-align: center;">
            <h2 style="color:var(--o-color);">IDENTIDADE</h2>
            <p style="color:#fff;">REGISTRE SEU NOME DE OPERADOR</p>
            <input type="text" id="permanent-nick-input" class="input-code" maxlength="10" placeholder="Nickname">
            <br>
            <button class="cyber-btn" onclick="saveInitialNickname()"><span>CONFIRMAR</span></button>
        </div>
    </div>

    <div id="ui-layer" class="hidden">
        <div class="hud-top pointer-events-auto">
            <button class="mute-btn" id="btn-mute" onclick="toggleMute()">üîä</button>
            <div style="font-size:0.7rem; color:#ffd700; letter-spacing:2px; cursor:pointer; text-shadow: 0 0 5px #ff0000;" onclick="copyCode()">SALA: <span id="room-code" style="color:#fff;">---</span></div>
            <div id="hint-pill">Sua Vez</div>
            <div class="scores">
                <div id="p1-score" class="player-score" onclick="showPlayerStats('X')"><div class="score-val" style="color:var(--x-color)">0</div><div class="player-name" id="name-x">P1</div></div>
                <div style="font-size:1.5rem; color:#fff;">//</div>
                <div id="p2-score" class="player-score" onclick="showPlayerStats('O')"><div class="score-val" style="color:var(--o-color)">0</div><div class="player-name" id="name-o">P2</div></div>
            </div>
            <div class="timer-container"><div id="timer-bar" class="timer-bar"></div></div>
        </div>
        
        <div id="toast-msg">TOAST</div>
        
        <div class="chat-bar">
            <button class="emoji-btn" onclick="sendChat('üéÖ')">üéÖ</button>
            <button class="emoji-btn" onclick="sendChat('üéÅ')">üéÅ</button>
            <button class="emoji-btn" onclick="sendChat('üéÑ')">üéÑ</button>
            <button class="emoji-btn" onclick="sendChat('üî•')">üî•</button>
        </div>

        <div class="hand-wrapper"><div id="hand-container" class="hand-container pointer-events-auto"></div></div>
        <button onclick="quitGame()" class="cyber-btn secondary pointer-events-auto" style="position:absolute; top:10px; right:10px; min-width:auto; padding:5px 15px; font-size:0.7rem;"><span>SAIR</span></button>
    </div>

    <div id="screen-menu" class="screen hidden">
        <div class="cyber-panel">
            <div class="title-glitch" id="main-title" style="font-size: 3.5rem; color: #ff0033;">CARTAS<br>VELHAS</div>
            <p id="subtitle-version" style="letter-spacing: 3px; color: #ffd700; margin-bottom: 20px; font-size: 0.9rem; font-weight: bold; text-shadow: 0 0 10px #ff0000;">üéÑ ESPECIAL DE NATAL v2.1 üéÑ</p>
            
            <div id="online-counter-display" class="online-tag hidden">
                <span class="live-dot">‚óè</span> <span id="online-count-val">0</span> ELFOS ONLINE
            </div>
            <br>
            
            <div id="guest-input-area" class="hidden">
                <p style="color:#aaa; font-size:0.8rem;">ACESSO RESTRITO</p>
                <button class="cyber-btn google-btn" onclick="loginGoogle()"><span>G+ ENTRAR COM GOOGLE</span></button>
            </div>

            <div id="user-profile-area" class="user-profile-container hidden">
                <img id="profile-img" class="user-avatar" src="" alt="User">
                <div class="user-info">
                    <div id="profile-name" class="user-nick">Player</div>
                    <div class="user-status">‚óè Pronto para o Natal</div>
                </div>
                <button class="cyber-btn" style="min-width:auto; padding:5px 10px; font-size:0.6rem; margin-left:10px;" onclick="openScreen('screen-profile')">PERFIL</button>
                <button class="cyber-btn secondary" style="min-width:auto; padding:5px 10px; font-size:0.6rem; margin-left:5px;" onclick="logout()">SAIR</button>
            </div>
            <br>
            
            <div id="game-controls" class="hidden">
                <button id="btn-quick" class="cyber-btn" onclick="startQuickMatch()"><span>‚ö° PARTIDA R√ÅPIDA</span></button>
                <br>
                <button class="cyber-btn" onclick="startBotMatch()"><span>ü§ñ JOGAR VS KRAMPUS</span></button>
                <br>
                <button class="cyber-btn secondary" style="width: 200px;" onclick="openScreen('screen-social')"><span>üë• AMIGOS & FESTA</span></button>
                <br>
                <div style="margin-top: 15px; display:flex; justify-content:center; gap:5px; flex-wrap:wrap;">
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-leaderboard')"><span>RANK</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-lobby-custom')"><span>SALAS</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-cards')"><span>CARTAS</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-updates')"><span>SOBRE</span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-social" class="screen hidden">
        <div class="cyber-panel" style="max-width: 700px;">
            <h2 style="color:#fff; margin-top:0;">LISTA DE BONZINHOS</h2>
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="color:#aaa; font-size:0.8rem; margin-top:0;">BUSCAR NOVOS AGENTES</p>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="search-player-input" class="input-code" placeholder="Nick exato" style="width:100%; font-size:0.9rem;">
                    <button id="btn-search" class="cyber-btn" onclick="searchPlayer()" style="min-width:auto;">üîç</button>
                </div>
                <div id="search-results-area" style="margin-top:10px;"></div>
            </div>
            <div id="friend-requests-area"><div id="friend-requests-list"></div></div>
            <h3 style="color:var(--o-color); font-size:1rem; border-bottom:1px solid #333; padding-bottom:5px;">MEUS AMIGOS</h3>
            <div id="friends-list-content" class="scroll-content" style="height: 250px;"><p style="color:#aaa; text-align:center;">Carregando lista...</p></div>
            <br><button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-profile" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">CART√ÉO DE NATAL</h2>
            <img id="detail-profile-img" class="big-avatar" src="" alt="Avatar">
            <br>
            <div style="margin-bottom: 20px;">
                <label style="color:#aaa; font-size:0.7rem;">NICKNAME</label><br>
                <div style="display:flex; justify-content:center; align-items:center; gap:5px;">
                    <input type="text" id="edit-nick-input" class="input-code" style="width: 200px; font-size:1rem; border-color: #555;" maxlength="10">
                    <button class="cyber-btn secondary" style="min-width: auto; padding: 10px;" onclick="saveNewNickname()">üíæ</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-box" style="border-color: #bd00ff;"><div class="stat-val" id="stat-rank">---</div><div class="stat-label">ELO RANK</div></div>
                <div class="stat-box" style="border-color: #00ff88;"><div class="stat-val" id="stat-wins">---</div><div class="stat-label">VIT√ìRIAS</div></div>
                <div class="stat-box" style="border-color: #ff0055;"><div class="stat-val" id="stat-losses">---</div><div class="stat-label">DERROTAS</div></div>
            </div>
            <div style="margin-top: 20px;">
                <label style="color:#aaa; font-size:0.7rem;">HIST√ìRICO</label>
                <div id="match-history-list" class="history-list"><div style="text-align:center;">Sem dados.</div></div>
            </div>
            <br><button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-lobby-custom" class="screen hidden">
        <h2 style="color:#fff;">MODO PRIVADO</h2>
        <button id="btn-create-room" class="cyber-btn" onclick="openLobby('host')"><span>CRIAR SALA</span></button>
        <button id="btn-join-room" class="cyber-btn" onclick="openLobby('join')"><span>ENTRAR COM C√ìDIGO</span></button>
        <br><br>
        <div id="lobby-friends-invite" style="margin-top:20px; display:none;">
            <p style="color:#aaa; font-size:0.8rem;">CHAMAR AMIGOS PARA A CEIA</p>
            <div id="lobby-friends-list" style="max-height:100px; overflow-y:auto;"></div>
        </div>
        <button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
    </div>

    <div id="screen-leaderboard" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#bd00ff; margin-top:0;">TOP 100 ELITE</h2>
            <div id="leaderboard-list" class="scroll-content" style="height: 400px;"><div class="loader"></div></div>
            <br><button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-cards" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">LISTA DE PRESENTES</h2>
            <div class="scroll-content" id="cards-list-ui"></div>
            <center><button class="cyber-btn secondary" style="margin-top:20px;" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button></center>
        </div>
    </div>

    <div id="screen-updates" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">SOBRE O SISTEMA</h2>
            <div style="text-align:center; margin-bottom: 30px;">
                <p style="color:#aaa; font-size:0.8rem;">DESENVOLVIDO POR:</p>
                <span class="credits-name" style="font-size: 1.5rem; color: #ff0033;">Guilherme Ot√°vio<br>Xavier de Souza</span>
                <p style="color:#ffd700; font-size:0.7rem; margin-top:5px;">MERRY CHRISTMAS ¬© 2025</p>
            </div>
            <hr style="border-color:#333; margin: 20px 0;">
            <h3 style="color:var(--o-color); margin-top:0;">CHANGELOG</h3>
            <div class="scroll-content" style="height: 200px;">
                <div class="update-block" style="border:none;">
                    <div class="update-title">v2.1.0 - EXTRAVAGANZA</div>
                    <span class="update-item">Mais Vermelho. Mais Luzes. Mais Caos.</span>
                    <span class="update-item">Borda Pisca-Pisca na tela.</span>
                    <span class="update-item">Efeitos 3D pulsantes.</span>
                </div>
            </div>
            <center><button class="cyber-btn secondary" style="margin-top:20px;" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button></center>
        </div>
    </div>

    <div id="screen-lobby-wait" class="screen hidden">
        <h2 style="color:#fff;">LOBBY</h2>
        <div id="lobby-host-ui" class="hidden" style="text-align:center;">
            <p style="color:#aaa;">C√ìDIGO DO PRESENTE</p>
            <div id="display-code" class="input-code" style="border:none; cursor:pointer; color:#ffd700;" onclick="copyCode()">...</div>
            <p style="color:var(--o-color); animation: pulse-border 1s infinite; padding: 5px;">Esperando o Grinch...</p>
        </div>
        <div id="lobby-client-ui" class="hidden" style="text-align:center;">
            <p style="color:#aaa;">DIGITE O C√ìDIGO</p>
            <input type="text" id="input-code" class="input-code" maxlength="6" placeholder="XXXXXX">
            <br><button id="btn-connect" class="cyber-btn" onclick="connectToHost()"><span>CONECTAR</span></button>
            <p id="client-status" class="match-log"></p>
        </div>
        <div id="lobby-quick-ui" class="hidden" style="text-align:center;">
            <p style="color:#00ff88; font-weight:bold;">BUSCANDO PARTIDA</p>
            <div class="loader"></div>
            <p id="quick-log" class="match-log">Olhando a lista...</p>
        </div>
        <button class="cyber-btn secondary" onclick="location.reload()" style="margin-top:30px;"><span>CANCELAR</span></button>
    </div>

    <div id="screen-gameover" class="screen hidden">
        <h1 id="winner-text" class="title-glitch" style="font-size:3rem;">VENCEDOR</h1>
        <div id="rematch-area"></div>
        <button class="cyber-btn secondary" onclick="location.reload()" style="margin-top:20px;"><span>SAIR</span></button>
    </div>

    <script src="game.js?v=2.1"></script>
</body>
</html>