<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="description" content="Cartas Velhas: Cyberpunk Tactics. Jogo de estrat√©gia 3D multiplayer.">
    <meta name="author" content="Guilherme Ot√°vio Xavier de Souza">
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="Cartas Velhas: Cyberpunk Tactics">
    <meta property="og:description" content="Desafia os teus amigos neste jogo t√°tico 3D. Regra do Infinito, Cartas Especiais e Multiplayer em tempo real.">
    <meta property="og:type" content="website">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">

    <title>Cartas Velhas: Cyberpunk Tactics v0.9.45 (SOCIAL HUB)</title>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="loading-screen">
        <div class="loader-content">
            <div class="glitch-text" style="font-size: 2rem; font-weight: bold; margin-bottom: 20px;">SYSTEM BOOT</div>
            <div class="loading-bar-frame">
                <div id="loading-fill" class="loading-bar-fill"></div>
            </div>
            <div id="loading-text" style="font-family: monospace; color: #00ff88; font-size: 0.8rem; margin-top: 10px;">> INITIALIZING KERNEL...</div>
        </div>
    </div>

    <div id="invite-modal" class="hidden" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.9); border:2px solid var(--o-color); padding:15px; z-index:2000; text-align:center; box-shadow:0 0 20px var(--o-color); min-width:250px;">
        <div style="color:#fff; font-weight:bold; margin-bottom:10px;">CONVITE RECEBIDO</div>
        <div id="invite-text" style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Player te chamou!</div>
        <button class="cyber-btn" onclick="acceptInvite()">ACEITAR</button>
        <button class="cyber-btn secondary" onclick="closeInvite()">RECUSAR</button>
    </div>

    <div id="canvas-container" style="position: absolute; top:0; left:0; width:100%; height:100%;"></div>

    <div id="modal-nickname" class="hidden">
        <div class="cyber-panel" style="text-align: center;">
            <h2 style="color:var(--o-color);">IDENTIFICA√á√ÉO</h2>
            <p style="color:#fff;">ESCOLHA SEU NOME DE GUERRA</p>
            <input type="text" id="permanent-nick-input" class="input-code" maxlength="10" placeholder="Nickname">
            <br>
            <button class="cyber-btn" onclick="saveInitialNickname()"><span>CONFIRMAR</span></button>
        </div>
    </div>

    <div id="ui-layer" class="hidden">
        <div class="hud-top pointer-events-auto">
            <button class="mute-btn" id="btn-mute" onclick="toggleMute()">üîä</button>
            <div style="font-size:0.7rem; color:#666; letter-spacing:2px; cursor:pointer;" onclick="copyCode()">SALA: <span id="room-code" style="color:#fff;">---</span></div>
            <div id="hint-pill">Sua Vez</div>
            <div class="scores">
                <div id="p1-score" class="player-score" onclick="showPlayerStats('X')"><div class="score-val" style="color:var(--x-color)">0</div><div class="player-name" id="name-x">P1</div></div>
                <div style="font-size:1.5rem; color:#444;">//</div>
                <div id="p2-score" class="player-score" onclick="showPlayerStats('O')"><div class="score-val" style="color:var(--o-color)">0</div><div class="player-name" id="name-o">P2</div></div>
            </div>
            <div class="timer-container"><div id="timer-bar" class="timer-bar"></div></div>
        </div>
        
        <div id="toast-msg">TOAST</div>
        
        <div class="chat-bar">
            <button class="emoji-btn" onclick="sendChat('üëã')">üëã</button>
            <button class="emoji-btn" onclick="sendChat('üòÇ')">üòÇ</button>
            <button class="emoji-btn" onclick="sendChat('üò°')">üò°</button>
            <button class="emoji-btn" onclick="sendChat('üëè')">üëè</button>
        </div>

        <div class="hand-wrapper"><div id="hand-container" class="hand-container pointer-events-auto"></div></div>
        <button onclick="quitGame()" class="cyber-btn secondary pointer-events-auto" style="position:absolute; top:10px; right:10px; min-width:auto; padding:5px 15px; font-size:0.7rem;"><span>SAIR</span></button>
    </div>

    <div id="screen-menu" class="screen hidden">
        <div class="cyber-panel">
            <div class="title-glitch">CARTAS<br>VELHAS</div>
            <p style="letter-spacing: 5px; color: var(--o-color); margin-bottom: 10px; font-size: 0.8rem;">TACTICAL SYSTEM v0.9.45 (SOCIAL HUB)</p>
            
            <div id="online-counter-display" class="online-tag hidden">
                <span class="live-dot">‚óè</span> <span id="online-count-val">0</span> AGENTES ONLINE
            </div>
            <br>
            
            <div id="guest-input-area" class="hidden">
                <p style="color:#aaa; font-size:0.8rem;">ACESSO RESTRITO A OPERADORES LOGADOS</p>
                <button class="cyber-btn google-btn" onclick="loginGoogle()"><span>G+ ENTRAR COM GOOGLE</span></button>
            </div>

            <div id="user-profile-area" class="user-profile-container hidden">
                <img id="profile-img" class="user-avatar" src="" alt="User">
                <div class="user-info">
                    <div id="profile-name" class="user-nick">Player</div>
                    <div class="user-status">‚óè Carregando stats...</div>
                </div>
                <button class="cyber-btn" style="min-width:auto; padding:5px 10px; font-size:0.6rem; margin-left:10px;" onclick="openScreen('screen-profile')">PERFIL</button>
                <button class="cyber-btn secondary" style="min-width:auto; padding:5px 10px; font-size:0.6rem; margin-left:5px;" onclick="logout()">SAIR</button>
            </div>
            <br>
            
            <div id="game-controls" class="hidden">
                <button id="btn-quick" class="cyber-btn" onclick="startQuickMatch()"><span>‚ö° PARTIDA R√ÅPIDA</span></button>
                <br>
                <button class="cyber-btn" onclick="startBotMatch()"><span>ü§ñ JOGAR VS BOT</span></button>
                <br>
                <button class="cyber-btn secondary" style="width: 200px;" onclick="openScreen('screen-social')"><span>üë• SOCIAL & AMIGOS</span></button>
                <br>
                <div style="margin-top: 5px; display:flex; justify-content:center; gap:5px; flex-wrap:wrap;">
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-leaderboard')"><span>RANK</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-lobby-custom')"><span>SALAS</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-cards')"><span>CARTAS</span></button>
                    <button class="cyber-btn secondary" style="min-width: 80px; font-size: 0.7rem;" onclick="openScreen('screen-updates')"><span>UPDATES</span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-social" class="screen hidden">
        <div class="cyber-panel" style="max-width: 700px;">
            <h2 style="color:#fff; margin-top:0;">REDE NEURAL</h2>
            
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="color:#aaa; font-size:0.8rem; margin-top:0;">BUSCAR NOVOS AGENTES</p>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="search-player-input" class="input-code" placeholder="Nick exato" style="width:100%; font-size:0.9rem;">
                    <button class="cyber-btn" onclick="searchPlayer()" style="min-width:auto;">üîç</button>
                </div>
                <div id="search-results-area" style="margin-top:10px;"></div>
            </div>

            <div id="friend-requests-area">
                <div id="friend-requests-list"></div>
            </div>

            <h3 style="color:var(--o-color); font-size:1rem; border-bottom:1px solid #333; padding-bottom:5px;">MEUS AMIGOS</h3>
            <div id="friends-list-content" class="scroll-content" style="height: 250px;">
                <p style="color:#aaa; text-align:center;">Carregando lista...</p>
            </div>
            
            <br>
            <button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-profile" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">DADOS DO OPERADOR</h2>
            <img id="detail-profile-img" class="big-avatar" src="" alt="Avatar">
            <br>
            <div style="margin-bottom: 20px;">
                <label style="color:#aaa; font-size:0.7rem;">NICKNAME (EDIT√ÅVEL)</label><br>
                <div style="display:flex; justify-content:center; align-items:center; gap:5px;">
                    <input type="text" id="edit-nick-input" class="input-code" style="width: 200px; font-size:1rem; border-color: #555;" maxlength="10">
                    <button class="cyber-btn secondary" style="min-width: auto; padding: 10px;" onclick="saveNewNickname()">üíæ</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-box" style="border-color: #bd00ff;"><div class="stat-val" id="stat-rank">---</div><div class="stat-label">ELO RANK</div></div>
                <div class="stat-box" style="border-color: #00ff88;"><div class="stat-val" id="stat-wins">---</div><div class="stat-label">VIT√ìRIAS</div></div>
                <div class="stat-box" style="border-color: #ff0055;"><div class="stat-val" id="stat-losses">---</div><div class="stat-label">DERROTAS</div></div>
            </div>
            <div style="margin-top: 20px;">
                <label style="color:#aaa; font-size:0.7rem;">HIST√ìRICO RECENTE (LOCAL)</label>
                <div id="match-history-list" class="history-list"><div style="text-align:center;">Sem dados.</div></div>
            </div>
            <br>
            <button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-leaderboard" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#bd00ff; margin-top:0;">TOP 100 ELITE</h2>
            <div id="leaderboard-list" class="scroll-content" style="height: 400px;"><div class="loader"></div></div>
            <br><button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
        </div>
    </div>

    <div id="screen-cards" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">CONHECIMENTO</h2>
            <div class="scroll-content" id="cards-list-ui"></div>
            <center><button class="cyber-btn secondary" style="margin-top:20px;" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button></center>
        </div>
    </div>

    <div id="screen-credits" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">CR√âDITOS</h2>
            <div style="color:#ccc; text-align:center;">
                DESENVOLVIDO POR: <span class="credits-name">Guilherme Ot√°vio<br>Xavier de Souza</span>
                <hr style="border-color:#333; margin: 20px 0;">
                <p>Engine: Three.js WebGL</p>
                <p>Network: PeerJS P2P</p>
                <p>Backend: Firebase Auth & Firestore</p>
            </div>
            <center><button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button></center>
        </div>
    </div>

    <div id="screen-updates" class="screen hidden">
        <div class="cyber-panel">
            <h2 style="color:#fff; margin-top:0;">SYSTEM LOG</h2>
            <div class="scroll-content">
                <div class="update-block">
                    <div class="update-title">v0.9.45 - Social Hub</div>
                    <span class="update-item">Feature: Tela Social Unificada (Busca + Amigos).</span>
                    <span class="update-item">Fix: Convites apenas para amigos Online.</span>
                    <span class="update-item">Fix: Persist√™ncia de pedidos de amizade offline.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.43 - Smart Boot</div>
                    <span class="update-item">UX: Loading Screen sincronizada com Login.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.40 - Boot Screen</div>
                    <span class="update-item">UX: Tela de carregamento estilo Terminal.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.38 - Icon Update</div>
                    <span class="update-item">UI: Novo √≠cone de aba (Favicon) estilo Rob√¥.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.37 - SEO Patch</div>
                    <span class="update-item">System: Metadados para Google e Redes Sociais adicionados.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.36 - Natural Case</div>
                    <span class="update-item">UI: Nomes exibidos conforme digitados.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.35 - Uniform Text</div>
                    <span class="update-item">UI: Padroniza√ß√£o de nomes em MAI√öSCULAS.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.34 - Live Ops</div>
                    <span class="update-item">Feature: Contador de Jogadores Online.</span>
                    <span class="update-item">System: Heartbeat autom√°tico para Firestore.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.33 - Security Patch</div>
                    <span class="update-item">Security: Token de valida√ß√£o de vit√≥ria.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.32 - Stable Camera</div>
                    <span class="update-item">UX: C√¢mera fixa no mobile para evitar erros.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.31 - Mobile Polish</div>
                    <span class="update-item">UX: Interface adaptativa para smartphones.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.30 - UI & DB Fix</div>
                    <span class="update-item">Fix: Alerta de erro no banco de dados.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.29 - Name Fix & UI Polish</div>
                    <span class="update-item">Fix: Salvar nome agora funciona corretamente.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.28 - Ultimate Update</div>
                    <span class="update-item">Feature: Chat R√°pido (Emojis).</span>
                    <span class="update-item">Feature: Bot√£o Mute & Hist√≥rico de Partidas.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.27 - Rank & Nick Fix</div>
                    <span class="update-item">Fix: Input de nome agora carrega o valor correto.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.26 - Login & Anim Fix</div>
                    <span class="update-item">Sistema: Jogo permitido apenas ap√≥s Login.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.25 - Security & Bot Fix</div>
                    <span class="update-item">Fix: Bot agora usa as cartas corretamente.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.24 - Fixes & Logs</div>
                    <span class="update-item">UI: Corre√ß√£o de alinhamento central dos pain√©is.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.23 - Fixes Finais</div>
                    <span class="update-item">Profile: Mudan√ßa de nome liberada.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.22 - Identidade & Ranking</div>
                    <span class="update-item">Sistema: Ranking Global (Top 100) por ELO.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.21 - Social & Fair Play</div>
                    <span class="update-item">Feature: Busca de Amigos (Tela Social).</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.20 - Perfil Avan√ßado</div>
                    <span class="update-item">Feature: Tela de Perfil completa.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.19 - Persist√™ncia Total</div>
                    <span class="update-item">Database: Firestore conectado.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.17 - Login System</div>
                    <span class="update-item">Backend: Integra√ß√£o com Firebase (Google).</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.16 - Stability Patch</div>
                    <span class="update-item">Seguran√ßa: Prote√ß√£o contra nomes inv√°lidos.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.15 - Quality of Life</div>
                    <span class="update-item">Corre√ß√£o: Jogador 2 recebe cartas.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.13 - Sync Fix</div>
                    <span class="update-item">Corre√ß√£o: Distribui√ß√£o de cartas corrigida.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.12 - Empate & Fixes</div>
                    <span class="update-item">Nova Regra: EMPATE se ambos vencerem na mesma jogada.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.10 - Bot Update</div>
                    <span class="update-item">Modo VS Bot Dispon√≠vel.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.9.9 - Restaura√ß√£o</div>
                    <span class="update-item">Corre√ß√£o Cr√≠tica: Matchmaking revertido.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.8.0 - Cyber Polish</div>
                    <span class="update-item">Menu Principal estilo "Terminal Hacker".</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.7.0 - Expans√£o Mobile</div>
                    <span class="update-item">Partida R√°pida: Algoritmo autom√°tico.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.6.0 - Polimento</div>
                    <span class="update-item">Handshake Robusto.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.5.0 - Multiplayer P2P</div>
                    <span class="update-item">Conex√£o Direta via PeerJS.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.4.0 - Sistema de Cartas</div>
                    <span class="update-item">Introdu√ß√£o do Deck Building.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.3.0 - A Revolu√ß√£o 3D</div>
                    <span class="update-item">Migra√ß√£o para Three.js.</span>
                </div>
                <div class="update-block">
                    <div class="update-title">v0.2.0 - A√ß√£o e "Sumo"</div>
                    <span class="update-item">Poderes Iniciais.</span>
                </div>
                <div class="update-block" style="border:none;">
                    <div class="update-title">v0.1.0 - A Base</div>
                    <span class="update-item">Mec√¢nica Principal: Regra do Infinito.</span>
                </div>
            </div>
            <center><button class="cyber-btn secondary" style="margin-top:20px;" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button></center>
        </div>
    </div>

    <div id="screen-lobby-custom" class="screen hidden">
        <h2 style="color:#fff;">MODO PRIVADO</h2>
        <button class="cyber-btn" onclick="openLobby('host')"><span>CRIAR SALA</span></button>
        <button class="cyber-btn" onclick="openLobby('join')"><span>ENTRAR COM C√ìDIGO</span></button>
        <br><br>
        <div id="lobby-friends-invite" style="margin-top:20px; display:none;">
            <p style="color:#aaa; font-size:0.8rem;">CONVIDAR AMIGOS ONLINE</p>
            <div id="lobby-friends-list" style="max-height:100px; overflow-y:auto;"></div>
        </div>
        <button class="cyber-btn secondary" onclick="openScreen('screen-menu')"><span>VOLTAR</span></button>
    </div>

    <div id="screen-lobby-wait" class="screen hidden">
        <h2 style="color:#fff;">LOBBY</h2>
        <div id="lobby-host-ui" class="hidden" style="text-align:center;">
            <p style="color:#aaa;">PARTILHE ESTE C√ìDIGO</p>
            <div id="display-code" class="input-code" style="border:none; cursor:pointer;" onclick="copyCode()">...</div>
            <p style="color:var(--o-color); animation: pulse-border 1s infinite; padding: 5px;">Aguardando oponente...</p>
        </div>
        <div id="lobby-client-ui" class="hidden" style="text-align:center;">
            <p style="color:#aaa;">DIGITE O C√ìDIGO</p>
            <input type="text" id="input-code" class="input-code" maxlength="6" placeholder="XXXXXX">
            <br><button id="btn-connect" class="cyber-btn" onclick="connectToHost()"><span>CONECTAR</span></button>
            <p id="client-status" class="match-log"></p>
        </div>
        <div id="lobby-quick-ui" class="hidden" style="text-align:center;">
            <p style="color:#00ff88; font-weight:bold;">BUSCANDO PARTIDA</p>
            <div class="loader"></div>
            <p id="quick-log" class="match-log">A iniciar...</p>
        </div>
        <button class="cyber-btn secondary" onclick="location.reload()" style="margin-top:30px;"><span>CANCELAR</span></button>
    </div>

    <div id="screen-gameover" class="screen hidden">
        <h1 id="winner-text" class="title-glitch" style="font-size:3rem;">VENCEDOR</h1>
        <div id="rematch-area"></div>
        <button class="cyber-btn secondary" onclick="location.reload()" style="margin-top:20px;"><span>SAIR</span></button>
    </div>

    <script src="game.js"></script>
</body>
</html>